!function(v){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=v();else if("function"==typeof define&&define.amd)define([],v);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);e.BandJS=v()}}(function(){return function c(e,d,n){function g(a,f){if(!d[a]){if(!e[a]){var u="function"==typeof require&&require;if(!f&&u)return u(a,!0);if(h)return h(a,!0);throw Error("Cannot find module '"+a+"'");}f=d[a]={exports:{}};
e[a][0].call(f.exports,function(b){var c=e[a][1][b];return g(c?c:b)},f,f.exports,c,e,d,n)}return d[a].exports}for(var h="function"==typeof require&&require,f=0;f<n.length;f++)g(n[f]);return g}({1:[function(e,d,n){(function(c){"object"===typeof n&&(d.exports=c())})(function(){return window.AudioContext||window.webkitAudioContext})},{}],2:[function(e,d,n){function c(c,f){c||(c="equalTemperament");f||(f="northAmerican");if("undefined"===typeof g.tuning[c])throw Error(c+" is not a valid tuning pack.");
if("undefined"===typeof g.rhythm[f])throw Error(f+" is not a valid rhythm pack.");var a=this,d,h=function(){},b=e("audiocontext"),q={2:6,4:3,8:4.5};a.packs=g;a.pitches=g.tuning[c];a.notes=g.rhythm[f];a.audioContext=new b;a.masterVolumeLevel=null;a.masterVolume=a.audioContext.createGain();a.masterVolume.connect(a.audioContext.destination);a.beatsPerBar=null;a.noteGetsBeat=null;a.tempo=null;a.instruments=[];a.totalDuration=0;a.currentSeconds=0;a.percentageComplete=0;a.noteBufferLength=20;a.onTickerCallback=
h;a.onFinishedCallback=h;a.onDurationChangeCallback=h;a.load=function(b){0<a.instruments.length&&a.destroy();if(!b)throw Error("JSON is required for this method to work.");if("undefined"===typeof b.instruments)throw Error("You must define at least one instrument");if("undefined"===typeof b.notes)throw Error("You must define notes for each instrument");"undefined"!==typeof b.timeSignature&&a.setTimeSignature(b.timeSignature[0],b.timeSignature[1]);"undefined"!==typeof b.tempo&&a.setTempo(b.tempo);var c=
{},f;for(f in b.instruments)b.instruments.hasOwnProperty(f)&&(c[f]=a.createInstrument(b.instruments[f].name,b.instruments[f].pack));for(var l in b.notes)if(b.notes.hasOwnProperty(l))for(f=-1;++f<b.notes[l].length;){var k=b.notes[l][f];"string"===typeof k?(k=k.split("|"),"rest"===k[1]?c[l].rest(k[0]):c[l].note(k[0],k[1],k[2])):"rest"===k.type?c[l].rest(k.rhythm):"note"===k.type&&c[l].note(k.rhythm,k.pitch,k.tie)}return a.finish()};a.createInstrument=function(b,c){b=new (e("./instrument.js"))(b,c,a);
a.instruments.push(b);return b};a.finish=function(){return d=new (e("./player.js"))(a)};a.destroy=function(){a.audioContext=new b;a.instruments.length=0;a.masterVolume=a.audioContext.createGain();a.masterVolume.connect(a.audioContext.destination)};a.setMasterVolume=function(b){1<b&&(b/=100);a.masterVolumeLevel=b;a.masterVolume.gain.setValueAtTime(b,a.audioContext.currentTime)};a.getTotalSeconds=function(){return Math.round(a.totalDuration)};a.setTickerCallback=function(b){if("function"!==typeof b)throw Error("Ticker must be a function.");
a.onTickerCallback=b};a.setTimeSignature=function(b,c){if("undefined"===typeof q[c])throw Error("The bottom time signature is not supported.");a.beatsPerBar=b;a.noteGetsBeat=q[c]};a.setTempo=function(b){a.tempo=60/b;d&&(d.resetTempo(),a.onDurationChangeCallback())};a.setOnFinishedCallback=function(b){if("function"!==typeof b)throw Error("onFinished callback must be a function.");a.onFinishedCallback=b};a.setOnDurationChangeCallback=function(b){if("function"!==typeof b)throw Error("onDurationChanged callback must be a function.");
a.onDurationChangeCallback=b};a.setNoteBufferLength=function(b){a.noteBufferLength=b};a.setMasterVolume(100);a.setTempo(120);a.setTimeSignature(4,4)}d.exports=c;var g={instrument:{},rhythm:{},tuning:{}};c.loadPack=function(c,f,a){if(-1===["tuning","rhythm","instrument"].indexOf(c))throw Error(c+" is not a valid Pack Type.");if("undefined"!==typeof g[c][f])throw Error("A(n) "+c+' pack with the name "'+f+'" has already been loaded.');g[c][f]=a}},{"./instrument.js":5,"./player.js":7,audiocontext:1}],
3:[function(e,d,n){d.exports=function(c,g){if(-1===["white","pink","brown","brownian","red"].indexOf(c))throw Error(c+" is not a valid noise sound");return{createNote:function(d){switch(c){case "white":for(var f=2*g.sampleRate,a=g.createBuffer(1,f,g.sampleRate),e=a.getChannelData(0),h=0;h<f;h++)e[h]=2*Math.random()-1;f=g.createBufferSource();f.buffer=a;f.loop=!0;f.connect(d);return f;case "pink":f=2*g.sampleRate;a=g.createBuffer(1,f,g.sampleRate);e=a.getChannelData(0);for(var b,q,l,t,m,r,k=h=b=q=
l=t=m=r=0;k<f;k++){var p=2*Math.random()-1;h=.99886*h+.0555179*p;b=.99332*b+.0750759*p;q=.969*q+.153852*p;l=.8665*l+.3104856*p;t=.55*t+.5329522*p;m=-.7616*m-.016898*p;e[k]=h+b+q+l+t+m+r+.5362*p;e[k]*=.11;r=.115926*p}f=g.createBufferSource();f.buffer=a;f.loop=!0;f.connect(d);return f;case "brown":case "brownian":case "red":f=2*g.sampleRate;a=g.createBuffer(1,f,g.sampleRate);e=a.getChannelData(0);for(b=h=0;b<f;b++)e[b]=(h+.02*(2*Math.random()-1))/1.02,h=e[b],e[b]*=3.5;f=g.createBufferSource();f.buffer=
a;f.loop=!0;f.connect(d);return f}}}}},{}],4:[function(e,d,n){d.exports=function(c,e){if(-1===["sine","square","sawtooth","triangle"].indexOf(c))throw Error(c+" is not a valid Oscillator type");return{createNote:function(d,f){var a=e.createOscillator();a.connect(d);a.type=c;a.frequency.value=f;return a}}}},{}],5:[function(e,d,n){d.exports=function(c,e,d){function f(a){if("undefined"===typeof d.notes[a])throw Error(a+" is not a correct rhythm.");return d.notes[a]*d.tempo/d.noteGetsBeat*10}c||(c="sine");
e||(e="oscillators");if("undefined"===typeof d.packs.instrument[e])throw Error(e+" is not a currently loaded Instrument Pack.");var a=this,g=0,h=1;a.totalDuration=0;a.bufferPosition=0;a.instrument=d.packs.instrument[e](c,d.audioContext);a.notes=[];a.setVolume=function(b){1<b&&(b/=100);h=b;return a};a.note=function(b,c,e,g){var m=f(b),l=e?0:.05*m;if(c){c=c.split(",");for(var k=-1;++k<c.length;){var p=c[k];p=p.trim();if("undefined"===typeof d.pitches[p]&&(p=parseFloat(p),isNaN(p)||0>p))throw Error(p+
" is not a valid pitch.");}}a.notes.push({cb:g,rhythm:b,pitch:c,duration:m,articulationGap:l,tie:e,startTime:a.totalDuration,stopTime:a.totalDuration+m-l,volumeLevel:h/4});a.totalDuration+=m;return a};a.rest=function(b){var c=f(b);a.notes.push({rhythm:b,pitch:!1,duration:c,articulationGap:0,startTime:a.totalDuration,stopTime:a.totalDuration+c});a.totalDuration+=c;return a};a.repeatStart=function(){g=a.notes.length;return a};a.repeatFromBeginning=function(b){g=0;a.repeat(b);return a};a.repeat=function(b){b=
"undefined"===typeof b?1:b;for(var c=a.notes.slice(g),f=0;f<b;f++)for(var e=-1;++e<c.length;){var d=void 0;var h=c[e];if(null===h||"object"!=typeof h)d=h;else{var k=h.constructor();for(d in h)h.hasOwnProperty(d)&&(k[d]=h[d]);d=k}d.startTime=a.totalDuration;d.stopTime=a.totalDuration+d.duration-d.articulationGap;a.notes.push(d);a.totalDuration+=d.duration}return a};a.resetDuration=function(){var b=-1,c=a.notes.length;for(a.totalDuration=0;++b<c;){var d=a.notes[b],e=f(d.rhythm),g=d.tie?0:.05*e;d.duration=
f(d.rhythm);d.startTime=a.totalDuration;d.stopTime=a.totalDuration+e-g;!1!==d.pitch&&(d.articulationGap=g);a.totalDuration+=e}}}},{}],6:[function(e,d,n){d.exports=e("./conductor.js");d.exports.loadPack("instrument","noises",e("./instrument-packs/noises.js"));d.exports.loadPack("instrument","oscillators",e("./instrument-packs/oscillators.js"));d.exports.loadPack("rhythm","northAmerican",e("./rhythm-packs/north-american.js"));d.exports.loadPack("rhythm","european",e("./rhythm-packs/european.js"));d.exports.loadPack("tuning",
"equalTemperament",e("./tuning-packs/equal-temperament.js"))},{"./conductor.js":2,"./instrument-packs/noises.js":3,"./instrument-packs/oscillators.js":4,"./rhythm-packs/european.js":8,"./rhythm-packs/north-american.js":9,"./tuning-packs/equal-temperament.js":10}],7:[function(e,d,n){d.exports=function(c){function d(b){for(var d=-1,e=c.instruments.length;++d<e;){var k=c.instruments[d];b&&k.resetDuration();k.bufferPosition=0}b&&(f(),m=c.percentageComplete*c.totalDuration);for(d=-1;++d<l.length;)l[d].gain.disconnect();
clearTimeout(q);l=a()}function e(a,d,e){"undefined"===typeof e&&(e=!1);if("up"!==a&&"down"!==a)throw Error("Direction must be either up or down.");r="down"===a;"up"===a?(c.masterVolume.gain.linearRampToValueAtTime(0,c.audioContext.currentTime),c.masterVolume.gain.linearRampToValueAtTime(c.masterVolumeLevel,c.audioContext.currentTime+.2)):(c.masterVolume.gain.linearRampToValueAtTime(c.masterVolumeLevel,c.audioContext.currentTime),c.masterVolume.gain.linearRampToValueAtTime(0,c.audioContext.currentTime+
.2));setTimeout(function(){"function"===typeof d&&d.call(b);e&&(r=!r,c.masterVolume.gain.linearRampToValueAtTime(c.masterVolumeLevel,c.audioContext.currentTime))},200)}function f(){for(var a=-1,b=0;++a<c.instruments.length;){var d=c.instruments[a];d.totalDuration>b&&(b=d.totalDuration)}c.totalDuration=b}function a(){for(var a=[],b=-1,d=c.noteBufferLength;++b<c.instruments.length;){for(var e=c.instruments[b],f=d,g=-1;++g<f;){var h=e.notes[e.bufferPosition+g];if("undefined"===typeof h)break;var l=h.pitch,
n=h.startTime,q=h.stopTime,t=h.volumeLevel;if(q<m)f++;else if(!1!==l){var r=c.audioContext.createGain();r.connect(c.masterVolume);r.gain.value=t;n<m&&(n=q-m);if("undefined"===typeof l)a.push({startTime:n<m?q-m:n,stopTime:q,node:e.instrument.createNote(r),gain:r,volumeLevel:t});else for(var u=-1;++u<l.length;){var w=l[u];a.push({cb:h.cb,startTime:n,stopTime:q,node:e.instrument.createNote(r,c.pitches[w.trim()]||parseFloat(w)),gain:r,volumeLevel:t})}}}e.bufferPosition+=f}return a}function n(){if(!b.paused&&
b.playing)if(c.totalDuration<m)if(b.stop(!1),b.looping)b.play();else c.onFinishedCallback();else u(),setTimeout(n,1E3/60)}function u(){m+=c.audioContext.currentTime-t;var a=Math.round(m);a!=c.currentSeconds&&(setTimeout(function(){c.onTickerCallback(a)},1),c.currentSeconds=a);c.percentageComplete=m/c.totalDuration;t=c.audioContext.currentTime;var d=Object.keys(b.comments);for(d.sort(function(a,b){return a-b});d.length&&b.comments[d[0]][0]<t;)document.getElementById("output").innerHTML+="<li>"+(d[0]+
1)+": "+b.comments[d[0]][1],delete b.comments[d[0]],d.shift()}var b=this,q,l=a(),t,m=0,r=!1;b.comments={};f();b.paused=!1;b.playing=!1;b.looping=!1;b.muted=!1;b.play=function(){b.playing=!0;b.paused=!1;t=c.audioContext.currentTime;n();var d=c.audioContext.currentTime-m,f=function(a){for(var c=-1;++c<a.length;){var e=a[c],f=e.startTime+d,k=e.stopTime+d;e.cb&&e.cb[1].length&&(b.comments[e.cb[0]]=[f,e.cb[1]]);e.tie||(0<f&&(f-=.001),k+=.001,e.gain.gain.setValueAtTime(0,f),e.gain.gain.linearRampToValueAtTime(e.volumeLevel,
f+.001),e.gain.gain.setValueAtTime(e.volumeLevel,k-.001),e.gain.gain.linearRampToValueAtTime(0,k));e.node.start(f);e.node.stop(k)}},g=function(){q=setTimeout(function(){if(b.playing&&!b.paused){var c=a();0<c.length&&(f(c),l=l.concat(c),g())}},5E3*c.tempo)};f(l);g();r&&!b.muted&&e("up")};b.stop=function(a){b.playing=!1;c.currentSeconds=0;c.percentageComplete=0;"undefined"===typeof a&&(a=!0);a&&!b.muted?e("down",function(){m=0;d();setTimeout(function(){c.onTickerCallback(c.currentSeconds)},1)},!0):
(m=0,d(),setTimeout(function(){c.onTickerCallback(c.currentSeconds)},1))};b.pause=function(){b.paused=!0;u();b.muted?d():e("down",function(){d()})};b.loop=function(a){b.looping=!!a};b.setTime=function(a){m=parseInt(a);d();b.playing&&!b.paused&&b.play()};b.resetTempo=function(){d(!0);b.playing&&!b.paused&&b.play()};b.mute=function(a){b.muted=!0;e("down",a)};b.unmute=function(a){b.muted=!1;e("up",a)}}},{}],8:[function(e,d,n){d.exports={semibreve:1,dottedMinim:.75,minim:.5,dottedCrotchet:.375,tripletMinim:.33333334,
crotchet:.25,dottedQuaver:.1875,tripletCrotchet:.166666667,quaver:.125,dottedSemiquaver:.09375,tripletQuaver:.083333333,semiquaver:.0625,tripletSemiquaver:.041666667,demisemiquaver:.03125}},{}],9:[function(e,d,n){d.exports={whole:1,dottedHalf:.75,half:.5,dottedQuarter:.375,tripletHalf:.33333334,quarter:.25,dottedEighth:.1875,tripletQuarter:.166666667,eighth:.125,dottedSixteenth:.09375,tripletEighth:.083333333,sixteenth:.0625,tripletSixteenth:.041666667,thirtySecond:.03125}},{}],10:[function(e,d,n){d.exports=
{C0:16.35,"C#0":17.32,Db0:17.32,D0:18.35,"D#0":19.45,Eb0:19.45,E0:20.6,F0:21.83,"F#0":23.12,Gb0:23.12,G0:24.5,"G#0":25.96,Ab0:25.96,A0:27.5,"A#0":29.14,Bb0:29.14,B0:30.87,C1:32.7,"C#1":34.65,Db1:34.65,D1:36.71,"D#1":38.89,Eb1:38.89,E1:41.2,F1:43.65,"F#1":46.25,Gb1:46.25,G1:49,"G#1":51.91,Ab1:51.91,A1:55,"A#1":58.27,Bb1:58.27,B1:61.74,C2:65.41,"C#2":69.3,Db2:69.3,D2:73.42,"D#2":77.78,Eb2:77.78,E2:82.41,F2:87.31,"F#2":92.5,Gb2:92.5,G2:98,"G#2":103.83,Ab2:103.83,A2:110,"A#2":116.54,Bb2:116.54,B2:123.47,
C3:130.81,"C#3":138.59,Db3:138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185,Gb3:185,G3:196,"G#3":207.65,Ab3:207.65,A3:220,"A#3":233.08,Bb3:233.08,B3:246.94,C4:261.63,"C#4":277.18,Db4:277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,Gb4:369.99,G4:392,"G#4":415.3,Ab4:415.3,A4:440,"A#4":466.16,Bb4:466.16,B4:493.88,C5:523.25,"C#5":554.37,Db5:554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,Gb5:739.99,G5:783.99,"G#5":830.61,Ab5:830.61,
A5:880,"A#5":932.33,Bb5:932.33,B5:987.77,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01}},{}]},{},[6])(6)});
