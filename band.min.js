!function(t){var e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.BandJS=t())}(function(){return function o(r,i,a){function u(n,t){if(!i[n]){if(!r[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(s)return s(n,!0);throw new Error("Cannot find module '"+n+"'")}t=i[n]={exports:{}};r[n][0].call(t.exports,function(t){var e=r[n][1][t];return u(e||t)},t,t.exports,o,r,i,a)}return i[n].exports}for(var s="function"==typeof require&&require,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,e,n){"object"==typeof n&&(e.exports=window.AudioContext||window.webkitAudioContext)},{}],2:[function(a,t,e){t.exports=n;const s=a("./events");var c={instrument:{},rhythm:{},tuning:{}};function n(t,e){if(e=e||"northAmerican",void 0===c.tuning[t=t||"equalTemperament"])throw new Error(t+" is not a valid tuning pack.");if(void 0===c.rhythm[e])throw new Error(e+" is not a valid rhythm pack.");function n(){}var o,u=this,r=a("audiocontext"),i={2:6,4:3,8:4.5};u.events=new s,u.packs=c,u.pitches=c.tuning[t],u.notes=c.rhythm[e],u.audioContext=new r,u.masterVolumeLevel=null,u.masterVolume=u.audioContext.createGain(),u.masterVolume.connect(u.audioContext.destination),u.beatsPerBar=null,u.noteGetsBeat=null,u.tempo=null,u.instruments=[],u.totalDuration=0,u.currentSeconds=0,u.percentageComplete=0,u.noteBufferLength=20,u.onTickerCallback=n,u.onFinishedCallback=n,u.onDurationChangeCallback=n,u.load=function(t){if(0<u.instruments.length&&u.destroy(),!t)throw new Error("JSON is required for this method to work.");if(void 0===t.instruments)throw new Error("You must define at least one instrument");if(void 0===t.notes)throw new Error("You must define notes for each instrument");void 0!==t.timeSignature&&u.setTimeSignature(t.timeSignature[0],t.timeSignature[1]),void 0!==t.tempo&&u.setTempo(t.tempo);var e,n,o={};for(e in t.instruments)t.instruments.hasOwnProperty(e)&&(o[e]=u.createInstrument(t.instruments[e].name,t.instruments[e].pack));for(n in t.notes)if(t.notes.hasOwnProperty(n))for(var r=-1;++r<t.notes[n].length;){var i,a=t.notes[n][r];"string"==typeof a?"rest"===(i=a.split("|"))[1]?o[n].rest(i[0]):o[n].note(i[0],i[1],i[2]):"rest"===a.type?o[n].rest(a.rhythm):"note"===a.type&&o[n].note(a.rhythm,a.pitch,a.tie)}return u.finish()},u.createInstrument=function(t,e){t=new(a("./instrument.js"))(t,e,u);return u.instruments.push(t),t},u.finish=function(){var t=a("./player.js");return o=new t(u)},u.destroy=function(){u.audioContext.close(),u.audioContext=new r,u.instruments.length=0,u.masterVolume=u.audioContext.createGain(),u.masterVolume.connect(u.audioContext.destination)},u.setMasterVolume=function(t){1<t&&(t/=100),u.masterVolumeLevel=t,u.masterVolume.gain.setValueAtTime(t,u.audioContext.currentTime)},u.getTotalSeconds=function(){return Math.round(u.totalDuration)},u.setTickerCallback=function(t){if("function"!=typeof t)throw new Error("Ticker must be a function.");u.onTickerCallback=t},u.setTimeSignature=function(t,e){if(void 0===i[e])throw new Error("The bottom time signature is not supported.");u.beatsPerBar=t,u.noteGetsBeat=i[e]},u.setTempo=function(t){u.tempo=60/t,o&&(o.resetTempo(),u.onDurationChangeCallback())},u.setOnFinishedCallback=function(t){if("function"!=typeof t)throw new Error("onFinished callback must be a function.");u.onFinishedCallback=t},u.setOnDurationChangeCallback=function(t){if("function"!=typeof t)throw new Error("onDurationChanged callback must be a function.");u.onDurationChangeCallback=t},u.setNoteBufferLength=function(t){u.noteBufferLength=t},u.setMasterVolume(100),u.setTempo(120),u.setTimeSignature(4,4)}n.loadPack=function(t,e,n){if(-1===["tuning","rhythm","instrument"].indexOf(t))throw new Error(t+" is not a valid Pack Type.");if(void 0!==c[t][e])throw new Error("A(n) "+t+' pack with the name "'+e+'" has already been loaded.');c[t][e]=n}},{"./events":3,"./instrument.js":6,"./player.js":8,audiocontext:1}],3:[function(t,e,n){e.exports=function(){var o={},r=o.hasOwnProperty;this.subscribe=function(t,e){r.call(o,t)||(o[t]=[]);var n=o[t].push(e)-1;return{remove:function(){delete o[t][n]}}},this.publish=function(t,e){r.call(o,t)&&o[t].forEach(function(t){t(null!=e?e:{})})}}},{}],4:[function(t,e,n){e.exports=function(A,E){if(-1!==["white","pink","brown","brownian","red"].indexOf(A))return{createNote:function(t){switch(A){case"white":for(var e=t,n=2*E.sampleRate,o=E.createBuffer(1,n,E.sampleRate),r=o.getChannelData(0),i=0;i<n;i++)r[i]=2*Math.random()-1;var a=E.createBufferSource();return a.buffer=o,a.loop=!0,a.connect(e),a;case"pink":for(var u,s,c,l,m,f,p,o=t,d=2*E.sampleRate,e=E.createBuffer(1,d,E.sampleRate),h=e.getChannelData(0),v=u=s=c=l=m=f=p=0;v<d;v++){var b=2*Math.random()-1;u=.99886*u+.0555179*b,s=.99332*s+.0750759*b,c=.969*c+.153852*b,l=.8665*l+.3104856*b,m=.55*m+.5329522*b,f=-.7616*f-.016898*b,h[v]=u+s+c+l+m+f+p+.5362*b,h[v]*=.11,p=.115926*b}a=E.createBufferSource();return a.buffer=e,a.loop=!0,a.connect(o),a;case"brown":case"brownian":case"red":for(var g=t,T=2*E.sampleRate,w=E.createBuffer(1,T,E.sampleRate),C=w.getChannelData(0),y=0,D=0;D<T;D++){var k=2*Math.random()-1;C[D]=(y+.02*k)/1.02,y=C[D],C[D]*=3.5}var x=E.createBufferSource();return x.buffer=w,x.loop=!0,x.connect(g),x}}};throw new Error(A+" is not a valid noise sound")}},{}],5:[function(t,e,n){e.exports=function(o,r){if(-1!==["sine","square","sawtooth","triangle"].indexOf(o))return{createNote:function(t,e){var n=r.createOscillator();return n.connect(t),n.type=o,n.frequency.value=e,n}};throw new Error(o+" is not a valid Oscillator type")}},{}],6:[function(t,e,n){e.exports=function(t,e,u){t=t||"sine";e=e||"oscillators";if(void 0===u.packs.instrument[e])throw new Error(e+" is not a currently loaded Instrument Pack.");function s(t){if(void 0===u.notes[t])throw new Error(t+" is not a correct rhythm.");return u.notes[t]*u.tempo/u.noteGetsBeat*10}var c=this,i=0,l=1;c.totalDuration=0,c.bufferPosition=0,c.instrument=u.packs.instrument[e](t,u.audioContext),c.notes=[],c.setVolume=function(t){return 1<t&&(t/=100),l=t,c},c.note=function(t,e,n){var o=s(t),r=n?0:.05*o;if(e){e=e.split(",");for(var i=-1;++i<e.length;){var a=(a=e[i]).trim();if(void 0===u.pitches[a]&&(a=parseFloat(a),isNaN(a)||a<0))throw new Error(a+" is not a valid pitch.")}}return c.notes.push({rhythm:t,pitch:e,duration:o,articulationGap:r,tie:n,startTime:c.totalDuration,stopTime:c.totalDuration+o-r,volumeLevel:l/4}),c.totalDuration+=o,c},c.rest=function(t){var e=s(t);return c.notes.push({rhythm:t,pitch:!1,duration:e,articulationGap:0,startTime:c.totalDuration,stopTime:c.totalDuration+e}),c.totalDuration+=e,c},c.repeatStart=function(){return i=c.notes.length,c},c.repeatFromBeginning=function(t){return i=0,c.repeat(t),c},c.repeat=function(t){t=void 0===t?1:t;for(var e=c.notes.slice(i),n=0;n<t;n++)for(var o=-1;++o<e.length;){var r=function(t){if(null===t||"object"!=typeof t)return t;var e,n=t.constructor();for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e[o]);r.startTime=c.totalDuration,r.stopTime=c.totalDuration+r.duration-r.articulationGap,c.notes.push(r),c.totalDuration+=r.duration}return c},c.resetDuration=function(){var t=-1,e=c.notes.length;for(c.totalDuration=0;++t<e;){var n=c.notes[t],o=s(n.rhythm),r=n.tie?0:.05*o;n.duration=s(n.rhythm),n.startTime=c.totalDuration,n.stopTime=c.totalDuration+o-r,!1!==n.pitch&&(n.articulationGap=r),c.totalDuration+=o}}}},{}],7:[function(t,e,n){e.exports=t("./conductor.js"),e.exports.loadPack("instrument","noises",t("./instrument-packs/noises.js")),e.exports.loadPack("instrument","oscillators",t("./instrument-packs/oscillators.js")),e.exports.loadPack("rhythm","northAmerican",t("./rhythm-packs/north-american.js")),e.exports.loadPack("rhythm","european",t("./rhythm-packs/european.js")),e.exports.loadPack("tuning","equalTemperament",t("./tuning-packs/equal-temperament.js"))},{"./conductor.js":2,"./instrument-packs/noises.js":4,"./instrument-packs/oscillators.js":5,"./rhythm-packs/european.js":9,"./rhythm-packs/north-american.js":10,"./tuning-packs/equal-temperament.js":11}],8:[function(t,e,n){e.exports=function(d){var r,o,a=this,u=l(),h=0,s=!1;function e(t){for(var e=-1,n=d.instruments.length;++e<n;){var o=d.instruments[e];t&&o.resetDuration(),o.bufferPosition=0}for(t&&(i(),h=d.percentageComplete*d.totalDuration),e=-1;++e<u.length;)u[e].gain.disconnect();clearTimeout(r),u=l()}function c(t,e,n){if(void 0===n&&(n=!1),"up"!==t&&"down"!==t)throw new Error("Direction must be either up or down.");s="down"===t,"up"===t?(d.masterVolume.gain.linearRampToValueAtTime(0,d.audioContext.currentTime),d.masterVolume.gain.linearRampToValueAtTime(d.masterVolumeLevel,d.audioContext.currentTime+.2)):(d.masterVolume.gain.linearRampToValueAtTime(d.masterVolumeLevel,d.audioContext.currentTime),d.masterVolume.gain.linearRampToValueAtTime(0,d.audioContext.currentTime+.2)),setTimeout(function(){"function"==typeof e&&e.call(a),n&&(s=!s,d.masterVolume.gain.linearRampToValueAtTime(d.masterVolumeLevel,d.audioContext.currentTime))},200)}function i(){for(var t=-1,e=0;++t<d.instruments.length;){var n=d.instruments[t];n.totalDuration>e&&(e=n.totalDuration)}d.totalDuration=e}function l(){for(var t=[],e=-1,n=d.noteBufferLength;++e<d.instruments.length;){for(var o=d.instruments[e],r=n,i=-1;++i<r;){var a=o.notes[o.bufferPosition+i];if(void 0===a)break;var u=a.pitch,s=a.startTime,c=a.stopTime,l=a.volumeLevel;if(c<h)r++;else if(!1!==u){var m=d.audioContext.createGain();if(m.connect(d.masterVolume),m.gain.value=l,s<h&&(s=c-h),void 0===u)t.push({startTime:s<h?c-h:s,stopTime:c,node:o.instrument.createNote(m),gain:m,volumeLevel:l});else for(var f=-1;++f<u.length;){var p=u[f];t.push({startTime:s,stopTime:c,node:o.instrument.createNote(m,d.pitches[p.trim()]||parseFloat(p)),gain:m,volumeLevel:l}),d.events.publish("bufferNotes",{note:a,notes:t})}}}o.bufferPosition+=r}return t}function t(){!a.paused&&a.playing&&(d.totalDuration<h?(a.stop(!1),a.looping?a.play():d.onFinishedCallback()):(n(),setTimeout(t,1e3/60)))}function n(){h+=d.audioContext.currentTime-o;var t=Math.round(h);t!=d.currentSeconds&&(setTimeout(function(){d.onTickerCallback(t)},1),d.currentSeconds=t),d.percentageComplete=h/d.totalDuration,o=d.audioContext.currentTime,d.events.publish("updateTotalPlayTime",{currentPlayTime:o})}i(),a.paused=!1,a.playing=!1,a.looping=!1,a.muted=!1,a.play=function(){a.playing=!0,a.paused=!1,o=d.audioContext.currentTime,t();var i=d.audioContext.currentTime-h,e=function(t){for(var e=-1;++e<t.length;){var n=t[e],o=n.startTime+i,r=n.stopTime+i;n.tie||(0<o&&(o-=.001),r+=.001,n.gain.gain.setValueAtTime(0,o),n.gain.gain.linearRampToValueAtTime(n.volumeLevel,o+.001),n.gain.gain.setValueAtTime(n.volumeLevel,r-.001),n.gain.gain.linearRampToValueAtTime(0,r)),n.node.start(o),n.node.stop(r)}},n=function(){r=setTimeout(function(){var t;a.playing&&!a.paused&&0<(t=l()).length&&(e(t),u=u.concat(t),n())},5e3*d.tempo)};e(u),n(),s&&!a.muted&&c("up")},a.stop=function(t){a.playing=!1,d.currentSeconds=0,(t=void(d.percentageComplete=0)===t?!0:t)&&!a.muted?c("down",function(){h=0,e(),setTimeout(function(){d.onTickerCallback(d.currentSeconds)},1)},!0):(h=0,e(),setTimeout(function(){d.onTickerCallback(d.currentSeconds)},1))},a.pause=function(){a.paused=!0,n(),a.muted?e():c("down",function(){e()})},a.loop=function(t){a.looping=!!t},a.setTime=function(t){h=parseInt(t),e(),a.playing&&!a.paused&&a.play()},a.resetTempo=function(){e(!0),a.playing&&!a.paused&&a.play()},a.mute=function(t){a.muted=!0,c("down",t)},a.unmute=function(t){a.muted=!1,c("up",t)}}},{}],9:[function(t,e,n){e.exports={semibreve:1,dottedMinim:.75,minim:.5,dottedCrotchet:.375,tripletMinim:.33333334,crotchet:.25,dottedQuaver:.1875,tripletCrotchet:.166666667,quaver:.125,dottedSemiquaver:.09375,tripletQuaver:.083333333,semiquaver:.0625,tripletSemiquaver:.041666667,demisemiquaver:.03125}},{}],10:[function(t,e,n){e.exports={whole:1,dottedHalf:.75,half:.5,dottedQuarter:.375,tripletHalf:.33333334,quarter:.25,dottedEighth:.1875,tripletQuarter:.166666667,eighth:.125,dottedSixteenth:.09375,tripletEighth:.083333333,sixteenth:.0625,tripletSixteenth:.041666667,thirtySecond:.03125}},{}],11:[function(t,e,n){e.exports={C0:16.35,"C#0":17.32,Db0:17.32,D0:18.35,"D#0":19.45,Eb0:19.45,E0:20.6,F0:21.83,"F#0":23.12,Gb0:23.12,G0:24.5,"G#0":25.96,Ab0:25.96,A0:27.5,"A#0":29.14,Bb0:29.14,B0:30.87,C1:32.7,"C#1":34.65,Db1:34.65,D1:36.71,"D#1":38.89,Eb1:38.89,E1:41.2,F1:43.65,"F#1":46.25,Gb1:46.25,G1:49,"G#1":51.91,Ab1:51.91,A1:55,"A#1":58.27,Bb1:58.27,B1:61.74,C2:65.41,"C#2":69.3,Db2:69.3,D2:73.42,"D#2":77.78,Eb2:77.78,E2:82.41,F2:87.31,"F#2":92.5,Gb2:92.5,G2:98,"G#2":103.83,Ab2:103.83,A2:110,"A#2":116.54,Bb2:116.54,B2:123.47,C3:130.81,"C#3":138.59,Db3:138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185,Gb3:185,G3:196,"G#3":207.65,Ab3:207.65,A3:220,"A#3":233.08,Bb3:233.08,B3:246.94,C4:261.63,"C#4":277.18,Db4:277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,Gb4:369.99,G4:392,"G#4":415.3,Ab4:415.3,A4:440,"A#4":466.16,Bb4:466.16,B4:493.88,C5:523.25,"C#5":554.37,Db5:554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,Gb5:739.99,G5:783.99,"G#5":830.61,Ab5:830.61,A5:880,"A#5":932.33,Bb5:932.33,B5:987.77,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01}},{}]},{},[7])(7)});
